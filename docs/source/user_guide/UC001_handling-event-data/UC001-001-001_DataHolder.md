# DataHolder

> Класс `DataHolder` отвечает за подготовку, структурирование и хранение данных, и используется для унификации работы с данными в рамках библиотеки sberpm. Для создания экземпляра класса требуются данные — журнал событий и соответствующие имена колонок. Данные необходимы в формате DataFrame или в виде файла на диске, например, CSV. Большинство модулей библиотеки работают только с данными, обернутыми в класс `DataHolder`.

## Назначение

Класс `DataHolder` предназначен для загрузки и подготовки исходных данных журнала событий в структурированный датасет, готовый к анализу с использованием алгоритмов Data Science. Класс служит контейнером для хранения структурированных данных и извлечения различных свойств, связанных с задачами Process Mining.
`DataHolder` может помочь в исследованиях данных, поиске узких мест и оценке эффективности процесса в целом.

Пример сценария использования класса DataHolder в рамках Process Mining исследования может выглядеть следующим образом:
1. У вас есть журнал событий отдела обслуживания клиентов компании, и вы хотите понять общие пути прохождения процесса обслуживания.
2. Вы загружаете журнал событий в экземпляр DataHolder, который очищает данные и структурирует их для анализа.
3. Наконец вы используете алгоритмы Process Mining для анализа подготовленных `DataHolder` размеченных данных, чтобы выявить паттерны и неэффективности в процессе обслуживания клиентов.

```{admonition} Теоретическая справка
:class: dropdown, tip

В этом модуле используются алгоритмы для предварительной обработки данных, что включает в себя: очистку данных, обработку пустых значений, форматирование временных меток, сортировку операций, выявление успешности экземпляров процесса и прочее.
`DataHolder` также предоставляет функции для манипулирования данными путём группировки и фильтрации событий на основе различных параметров.
`DataHolder` дает много возможностей для извлечения свойств данных, имеющих значение для задач Process Mining. Вы можете использовать свойства `DataHolder` для выявления маркеров бизнес-процесса.
```

## Формализация задачи

Методы в классе `DataHolder` учитывают методологию Process Mining, подготавливая и структурируя данные журнала событий для анализа. План выполнения алгоритмов внутри модели включает шаги, такие как очистка и форматирование временных меток, обработка пустых значений и сортировка событий для выделения последовательности операций. Эти этапы предобработки данных критически важны для Process Mining, так как они обеспечивают приведение данных в согласованный формат, который способствует выявлению шаблонов, неэффективности процессов, узких мест и других важных аспектов, связанных с бизнес-процессами.

## Функционал и работа с сервисами

Функционал класса `DataHolder` предоставляет методы для обработки и анализа данных, связанных с задачами Process Mining. Класс работает с данными в формате DataFrame или с файлом на диске.

### Параметры и их использование

``` {list-table} Параметры модели
:header-rows: 1

*   - Параметр
    - Пояснение к параметру 
    - Принимаемые значения

*   - {bdg-primary-line}`Лог (data)`
    - DataFrame, содержащий данные о событиях процесса, необходимые для восстановления эпизодов, определяющих выполнение процесса.
    - Может быть объектом pandas.DataFrame или путем к файлу. Поддерживаемые форматы файлов: 'csv', 'xls'/'xlsx', 'txt'. Должен содержать, как минимум, три ключевых столбца: идентификатор экземпляра, название события (операция), временная метка.

*   - {bdg-primary-line}`ID экземпляра (col_case)`
    - Имя столбца в данных, содержащего идентификаторы экземпляров процесса.
    - Обычно используется для группировки операций в экземпляр.

*   - {bdg-primary-line}`ID события (col_stage)`
    - Имя столбца в данных, содержащего названия событий процесса — операций.
    - Оно представляет фактические события или операции, которые произошли в процессе.

*   - {bdg-primary-line}`Время начала (col_start_time)`
    - Имя столбца в данных, содержащего записи даты и времени начала каждой операции.
    - Отметки времени существенны для понимания порядка операций и их длительности. Может быть установлен как параметр или вычислен из столбцов времени окончания и длительности операции.

*   - {bdg-primary-line}`Время окончания (col_end_time)`
    - Имя столбца в данных, содержащего записи даты и времени конца каждой операции.
    - Отметки времени существенны для понимания порядка операций и их длительности. Может быть установлен как параметр или вычислен из столбцов времени начала и длительности операции.

*   - {bdg-primary-line}`Пользователь (col_user)`
    - Имя столбца в данных, содержащего идентификаторы пользователей или ресурсов, выполняющих или инициирующих операцию.
    - Для идентификации, кто или что может совершить указанное действие. Это может быть имя пользователя, идентификатор или даже сессия или любой другой идентификатор.

*   - {bdg-primary-line}`Текстовые комментарии(col_text)`
    - Имя столбца в данных, содержащего текстовые комментарии, связанные с каждой операцией.
    - Эти комментарии часто описывают само действие, но также могут включать детали о любых других аспектах процесса. Могут не быть уникальными.

*   - {bdg-primary-line}`Длительность события (col_duration)`
    - Имя столбца в данных, содержащего записи длительности для каждой операции.
    - Каждая длительность представляет собой период времени, необходимый для выполнения определенного действия. Полученные значения длительности будут числовыми, преобразованными в секунды или другие единицы времени, установленные с помощью DurationUnits.
    
*   - {bdg-primary-line}`Успех экземпляра (col_case_success)`
    - Имя столбца в данных, содержащего индикаторы успеха для каждого экземпляра.
    - Показывает, был ли экземпляр успешно завершен в соответствии с критериями успеха экземпляра. Состоит из значений 'True' или 'False', которые не могут изменяться в конкретном идентификаторе экземпляра.
    
*   - {bdg-primary-line}`Разделитель колонок (sep)`
    - Разделительный символ, используемый в исходных файлах, например 'csv', для различения столбцов.
    - Если передан файл, требуется задать. Если файл использует разделитель, отличный от запятой (`","`), вы должны установить этот параметр.
    
*   - {bdg-primary-line}`Кодировка (encoding)`
    - Формат кодирования символов, используемый в строке исходного файла.
    - Необходимо установить правильное значение, чтобы избежать ошибок и прочитать данные, если кодировка данных отличается от unicode (UTF-8).
    
*   - {bdg-primary-line}`Количество строк для чтения (nrows)`
    - Ограничивает количество строк в данных для чтения. При None читаются все строки.
    - Может быть полезно для крупных файлов, чтобы взглянуть на первые N строк.
    
*   - {bdg-primary-line}`Обработка (preprocess)`
    - Определяет, должны ли данные подвергаться предварительной обработке.
    - `True`. Предварительная обработка может включать нормализацию данных, обработку отсутствующих значений, оптимизацию типов данных и другое.

*   - {bdg-primary-line}`Формат даты (time_format)`
    - Формат строки для анализа и преобразования столбцов с датой и временем в исходных данных.
    - Чтобы предотвратить ошибки из-за неоднозначных форматов дат, необходимо указать, возникают ли ошибки при парсинге времени или требуется ли определенный формат даты и времени.

*   - {bdg-primary-line}`Ошибки с датой (time_errors)`
    - Определяет поведение при возникновении ошибки разбора времени.
    - `TimeErrors.RAISE`. Для определения действий при нахождении неверного формата даты и времени.

*   - {bdg-primary-line}`День сначала (dayfirst)`
    - Определяет, следует ли интерпретировать первое значение в неоднозначной дате как день.
    - `True`. Для обработки дат в форматах, где день идет перед месяцем. Предпочтение парсинга даты сначала с днем.

*   - {bdg-primary-line}`Год сначала (yearfirst)`
    - Определяет, следует ли интерпретировать первое значение в неоднозначной дате как год.
    - `False`. Для обработки дат в форматах, где год идет перед днем и месяцем. Предпочтение парсинга даты сначала с годом.

*   - {bdg-primary-line}`Часовой пояс (utc)`
    - Управляет локализацией для разбора даты и времени, связанных с часовым поясом.
    - `False`. Для обеспечения согласованности временных меток в наборах данных, охватывающих несколько часовых поясов. Преобразование всех временных меток, осведомленных о часовом поясе, в UTC.

*   - {bdg-primary-line}`Единица длительности (duration_unit)`
    - Единица времени значений длительности операций.
    - `DurationUnits. SECOND` Влияет на масштаб метрик длительности.

*   - {bdg-primary-line}`Пропуск выходных (skip_weekends)`
    - Указывает, следует ли исключать записи, приходящиеся на выходные дни.
    - `False`. Может помочь в бизнес-анализе процессов, которые не учитывают выходные.

*   - {bdg-primary-line}`Кастомные выходные (skip_holidays_list)`
    - Список произвольных дат в году, представляющих праздники.
    - `()`. Для исключения дней, которые могут исказить длительность операций. Даты должны быть добавлены вручную в список.

*   - {bdg-primary-line}`success_inputs`
    - Колонка в данных + записи в колонке, которые определяют критерии успеха для идентификаторов процесса.
    - Этот параметр необходим для маркировки case ID как успешных или неуспешных на основе включения определенных записей в колонку. Каждая запись 'entry' из SuccessInputs. entries подразумевает успех case ID, который содержит любую из этих записей.
```

### Краевые случаи

 Проблемы, которые могут возникнуть при использовании класса DataHolder:

- Возможны сообщения об ошибках из-за отсутствия  некоторых колонок, необходимых для анализа процессов.
- Исключения вида LogWithout<COLUMN_NAME>Error выводятся при попытке доступа к определённым атрибутам, для которых отсутствует колонка в данных.
- `AttributeError` и `AssertionError` будут вызваны при попытках изменения атрибутов `DataHolder` или неправильном использовании метода `copy`.
